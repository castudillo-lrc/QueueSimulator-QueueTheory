"use strict";function po(e,t,i){for(var a=0,n=0;i>n;n++)a+=1/factorial(n)*Math.pow(e/t,n);return a+=1/factorial(i)*Math.pow(e/t,i)*(i*t/(i*t-e)),1/a}function l(e,t,i){var a=0;return a=e*t*Math.pow(e/t,i)/(factorial(i-1)*Math.sqrt(i*t-e)*po(e,t,i)+e/t)}function w(e,t,i){return l(e,t,i)/e}function lq(e,t,i){return l(e,t,i)-e/t}function wq(e,t,i){return lq(e,t,i)/e}function rate(e,t,i){return e/(i*t)}function factorial(e){for(var t=1,i=1;e>=i;i++)t*=i;return t}function setLapses(e){var t=new Rands;console.log($("#lambdaid").val()+" + "+$("#muiid").val()),lambda=$("#lambdaid").val(),miu=$("#muiid").val(),lapses=t.poisson(lambda,[e]),exponential=t.exponential(500*miu,[1e3]);for(var i=0;i<lapses.length;i++)0==lapses[i]&&(lapses[i]=1)}function sendClients(){setInterval(function(){for(var e=0;e<lapses[pos];e++)!function(e){setTimeout(function(){$("#fila").append('<div id="example-'+id+'" class="circle small"></div>'),moveClient("#example-"+id,0,200),moveClient("#example-"+id,350,200),queue.push("#example-"+id),quantity+=1,$("#queueSize").text(quantity),id++},5e3/e)}(e);pos+=1},5e3)}function path1(e){moveClient(e,575,40),arrServers[0]=1,ereaseClient(e,0,40)}function path2(e){moveClient(e,575,145),arrServers[1]=1,ereaseClient(e,1,145)}function path3(e){moveClient(e,575,250),arrServers[2]=1,ereaseClient(e,2,250)}function path4(e){moveClient(e,575,350),arrServers[3]=1,ereaseClient(e,3,350)}function ereaseClient(e,t,i){quantity-=1,$("#queueSize").text(quantity),setTimeout(function(){moveClient(e,600,i),console.log("borrando "+e),$(e).remove(),arrServers[t]=0,console.log("borrado "+exponential.shift())},1/exponential.shift()+5e3)}function printClients(){setInterval(function(){console.log(quantity);var e=Math.random();if(-1!=$.inArray(0,arrServers)&&"undefined"!==queue[0])try{0==arrServers[0]&&.25>e?path1(queue.shift()):0==arrServers[1]&&e>=.25&&.5>e?path2(queue.shift()):0==arrServers[2]&&e>=.5&&.75>e?path3(queue.shift()):0==arrServers[3]&&e>=.75&&1>e&&path4(queue.shift())}catch(t){}},100)}function moveClient(e,t,i){move(e).to(t,i).duration("2s").end()}function init(){console.log("initiating simulation"),setLapses(24),sendClients(),printClients()}$("#playButton").click(function(){$("#rP0").text(po($("#lambdaid").val(),$("#muiid").val(),4)),$("#rl").text(l($("#lambdaid").val(),$("#muiid").val(),4)),$("#rw").text(w($("#lambdaid").val(),$("#muiid").val(),4)),$("#rlq").text(lq($("#lambdaid").val(),$("#muiid").val(),4)),$("#rwq").text(wq($("#lambdaid").val(),$("#muiid").val(),4)),$("#rrate").text(rate($("#lambdaid").val(),$("#muiid").val(),4))});var arrServers=[0,0,0,0],id=1,pos=0,quantity=0,queue=[],lambda=$("#lambdaid").val(),miu=$("#muiid").val(),exponential=[];$("#queueSize").text(quantity);var lapses=[];document.getElementById("playButton").onclick=function(){init()},$("#lambdaid").on("input",function(){this.value&&$("#muiid").on("input",function(){this.value&&$("#playButton").prop("disabled",!1)})});